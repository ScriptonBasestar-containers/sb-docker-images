.PHONY: help up down restart logs ps shell clean download-config logs-mediawiki logs-mariadb logs-redis

help: ## Show this help message
	@echo 'üìù Available commands:'
	@echo ''
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | \
		awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'
	@echo ''

up: ## Start all services
	@echo "üöÄ Starting MediaWiki standalone..."
	docker compose up -d
	@echo "‚úÖ Services started!"
	@echo ""
	@echo "üìç Access MediaWiki at: http://localhost:8200"

down: ## Stop all services
	@echo "‚èπÔ∏è  Stopping services..."
	docker compose down
	@echo "‚úÖ Stopped"

restart: ## Restart all services
	@echo "üîÑ Restarting services..."
	docker compose restart
	@echo "‚úÖ Restarted"

logs: ## View logs from all services
	docker compose logs -f

logs-mediawiki: ## View MediaWiki logs only
	docker compose logs -f mediawiki

logs-mariadb: ## View MariaDB logs only
	docker compose logs -f mariadb

logs-redis: ## View Redis logs only
	docker compose logs -f redis

ps: ## List running containers
	docker compose ps

shell: ## Access MediaWiki container shell
	docker compose exec mediawiki bash

download-config: ## Download LocalSettings.php from container
	@echo "üì• Downloading LocalSettings.php from container..."
	docker compose cp mediawiki:/var/www/html/LocalSettings.php ./LocalSettings.php
	@echo "‚úÖ LocalSettings.php downloaded. Uncomment the volume mount in compose.yml to use it."

clean: ## Stop and remove all containers, networks, and volumes
	@echo "‚ö†Ô∏è  WARNING: This will remove all containers, networks, and volumes!"
	@echo "‚ö†Ô∏è  All data will be lost!"
	@read -p "Are you sure? [y/N] " -n 1 -r; \
	echo; \
	if [[ $$REPLY =~ ^[Yy]$$ ]]; then \
		docker compose down -v; \
		echo "‚úÖ Cleaned!"; \
	else \
		echo "‚ùå Cancelled"; \
	fi
