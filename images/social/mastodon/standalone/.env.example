# Mastodon Standalone Environment Variables
# Copy this file to .env and update the values
#
# Mastodon is a free, open-source social network server
# See: https://joinmastodon.org/

# ============================================================================
# Web Server Settings
# ============================================================================
MASTODON_WEB_PORT=8500
# Default: 8500 (recommended port for Mastodon web)
# Change this if you need to avoid port conflicts

MASTODON_STREAMING_PORT=8501
# Default: 8501 (recommended port for Mastodon streaming)
# WebSocket server for real-time updates

# ============================================================================
# Site Configuration
# ============================================================================
LOCAL_DOMAIN=localhost:8500
# The domain where your Mastodon instance will be accessible
# For production: use your actual domain (e.g., mastodon.example.com)
# WARNING: This cannot be changed later without breaking federation!

SINGLE_USER_MODE=false
# Set to true if you want to run a single-user instance
# Options: true, false

# ============================================================================
# Database Configuration (PostgreSQL)
# ============================================================================
DB_HOST=postgres
DB_PORT=5432
DB_USER=mastodon
DB_PASS=mastodon_password
DB_NAME=mastodon_production
# WARNING: Change DB_PASS in production!
# Use a strong, unique password (16+ characters)

POSTGRES_USER=mastodon
POSTGRES_PASSWORD=mastodon_password
POSTGRES_DB=mastodon_production
# PostgreSQL container environment variables

# ============================================================================
# Redis Configuration
# ============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
# Redis is used for cache and session storage

# ============================================================================
# Secrets Configuration
# ============================================================================
SECRET_KEY_BASE=changeme
# REQUIRED: Generate with:
# docker run --rm tootsuite/mastodon:v4.2 bundle exec rake secret

OTP_SECRET=changeme
# REQUIRED: Generate with:
# docker run --rm tootsuite/mastodon:v4.2 bundle exec rake secret

VAPID_PRIVATE_KEY=
VAPID_PUBLIC_KEY=
# REQUIRED: Generate with:
# docker run --rm tootsuite/mastodon:v4.2 bundle exec rake mastodon:webpush:generate_vapid_key
# This command will output both keys - copy them here

# ============================================================================
# Storage Configuration
# ============================================================================
S3_ENABLED=false
# Set to true if you want to use S3-compatible storage
# For local storage, leave as false

# S3 Configuration (if S3_ENABLED=true)
# S3_BUCKET=mastodon-files
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# S3_REGION=us-east-1
# S3_PROTOCOL=https
# S3_HOSTNAME=s3.amazonaws.com

# ============================================================================
# Email Configuration (SMTP)
# ============================================================================
SMTP_SERVER=smtp.mailgun.org
# SMTP server address

SMTP_PORT=587
# SMTP port (usually 587 for TLS, 465 for SSL)

SMTP_LOGIN=
# SMTP username

SMTP_PASSWORD=
# SMTP password

SMTP_FROM_ADDRESS=notifications@localhost
# Email sender address
# For production: use a real email (e.g., notifications@mastodon.example.com)

# Optional SMTP settings
# SMTP_AUTH_METHOD=plain
# SMTP_OPENSSL_VERIFY_MODE=none
# SMTP_ENABLE_STARTTLS_AUTO=true

# ============================================================================
# Container Names
# ============================================================================
MASTODON_WEB_CONTAINER=mastodon-web
MASTODON_STREAMING_CONTAINER=mastodon-streaming
MASTODON_SIDEKIQ_CONTAINER=mastodon-sidekiq
POSTGRES_CONTAINER_NAME=mastodon-postgres
REDIS_CONTAINER_NAME=mastodon-redis

# ============================================================================
# Volume Names
# ============================================================================
POSTGRES_DATA_VOLUME=postgres-data
REDIS_DATA_VOLUME=redis-data
MASTODON_PUBLIC_SYSTEM=mastodon-public-system

# ============================================================================
# SETUP INSTRUCTIONS
# ============================================================================
# 1. Generate secrets:
#    docker run --rm tootsuite/mastodon:v4.2 bundle exec rake secret
#    (Run twice for SECRET_KEY_BASE and OTP_SECRET)
#
# 2. Generate VAPID keys:
#    docker run --rm tootsuite/mastodon:v4.2 bundle exec rake mastodon:webpush:generate_vapid_key
#
# 3. Update LOCAL_DOMAIN to your actual domain
#
# 4. Start services:
#    docker compose up -d
#
# 5. Setup database:
#    docker compose exec web rails db:migrate
#    docker compose exec web rails db:seed
#
# 6. Create admin user:
#    docker compose exec web bin/tootctl accounts create \
#      admin \
#      --email admin@example.com \
#      --confirmed \
#      --role Owner
#
# 7. Precompile assets (optional for production):
#    docker compose exec web rails assets:precompile

# ============================================================================
# SECURITY WARNINGS
# ============================================================================
# ðŸ”’ IMPORTANT: Before deploying to production:
#
# 1. Generate unique SECRET_KEY_BASE and OTP_SECRET
# 2. Generate VAPID keys for web push notifications
# 3. Change all database passwords
# 4. Set LOCAL_DOMAIN to your actual domain (cannot be changed later!)
# 5. Configure SMTP for email notifications
# 6. Set up SSL/TLS certificates (HTTPS is required for federation)
# 7. Configure S3 or other object storage for media files
# 8. Set up regular database backups
# 9. Review Mastodon security best practices
# 10. Configure rate limiting and DDoS protection
# 11. Set up monitoring and logging
#
# Documentation:
# https://docs.joinmastodon.org/admin/install/
# https://docs.joinmastodon.org/admin/config/
# ============================================================================
