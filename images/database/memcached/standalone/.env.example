# Memcached Standalone Environment Configuration
# Copy this file to .env and customize the values

# ====================
# Project Settings
# ====================
PROJECT_NAME=memcached
TZ=Asia/Seoul

# ====================
# Port Configuration
# ====================
MEMCACHED_PORT=11211

# ====================
# Docker Image
# ====================
# Available tags: 1.6-alpine, 1.6, alpine, latest
MEMCACHED_TAG=1.6-alpine

# ====================
# Memcached Configuration
# ====================
# Memory limit in MB
# Examples: 64, 128, 256, 512, 1024
MEMCACHED_MEMORY=64

# Maximum simultaneous connections
MEMCACHED_MAX_CONNECTIONS=1024

# Maximum item size
# Examples: 1m, 2m, 5m, 10m
MEMCACHED_MAX_ITEM_SIZE=1m

# ====================
# Container Names
# ====================
MEMCACHED_CONTAINER_NAME=memcached

# ====================
# Network Names
# ====================
CACHE_NETWORK=cache-network

# ====================
# Security Notes
# ====================
# ⚠️  IMPORTANT Security Recommendations:
#
# 1. Network Isolation:
#    - Memcached has NO built-in authentication
#    - NEVER expose to public internet
#    - Use firewall to restrict access
#    - Bind to localhost only in production
#
# 2. Docker Network:
#    - Keep in private network
#    - Only accessible from application containers
#    - Use Docker network for isolation
#
# 3. Resource Limits:
#    - Set appropriate memory limit (MEMCACHED_MEMORY)
#    - Monitor memory usage
#    - Configure eviction policy (LRU is default)
#
# 4. Monitoring:
#    - Monitor cache hit/miss ratio
#    - Watch memory usage: make stats
#    - Set up alerts for connection limits
#
# 5. Production Deployment:
#    - Use reverse proxy for access control
#    - Consider SASL authentication (not in alpine)
#    - Use VPN or private network
#
# 6. Common Security Mistakes:
#    - ❌ Exposing port 11211 to 0.0.0.0
#    - ❌ No firewall rules
#    - ❌ Running on public cloud without VPC
#    - ✅ Bind to localhost or private network only
#    - ✅ Use Docker network isolation
#    - ✅ Implement application-level auth

# ====================
# Usage Examples
# ====================
# Start Memcached:
#   make up
#
# Test connection:
#   make test
#
# View statistics:
#   make stats
#
# Set a value (via telnet or nc):
#   echo -e "set mykey 0 60 5\r\nhello\r\n" | nc localhost 11211
#
# Get a value:
#   echo -e "get mykey\r\n" | nc localhost 11211
#
# Delete a value:
#   echo -e "delete mykey\r\n" | nc localhost 11211
#
# Flush all data:
#   echo -e "flush_all\r\n" | nc localhost 11211

# ====================
# Memcached Commands
# ====================
# Storage commands:
#   set <key> <flags> <exptime> <bytes>
#   add <key> <flags> <exptime> <bytes>
#   replace <key> <flags> <exptime> <bytes>
#   append <key> <flags> <exptime> <bytes>
#   prepend <key> <flags> <exptime> <bytes>
#
# Retrieval commands:
#   get <key>
#   gets <key>  # with CAS value
#
# Delete command:
#   delete <key>
#
# Increment/Decrement:
#   incr <key> <value>
#   decr <key> <value>
#
# Statistics:
#   stats
#   stats items
#   stats slabs
#   stats sizes
#
# Other:
#   flush_all
#   version
#   quit

# ====================
# Performance Tuning
# ====================
# For high-performance scenarios:
#
# 1. Increase memory:
#    MEMCACHED_MEMORY=512
#
# 2. Increase max connections:
#    MEMCACHED_MAX_CONNECTIONS=2048
#
# 3. Increase max item size (if needed):
#    MEMCACHED_MAX_ITEM_SIZE=5m
#
# 4. Use multiple Memcached instances (sharding)
#
# 5. Monitor and optimize:
#    - Cache hit ratio (should be > 90%)
#    - Eviction rate (should be low)
#    - Connection usage

# ====================
# Memory Management
# ====================
# Memcached uses LRU (Least Recently Used) eviction
# When memory is full:
# 1. LRU items are evicted
# 2. New items are stored
#
# Monitor evictions:
#   make stats | grep evictions
#
# If evictions are high:
# 1. Increase MEMCACHED_MEMORY
# 2. Review caching strategy
# 3. Check item TTLs
# 4. Consider using multiple instances

# ====================
# Common Use Cases
# ====================
# 1. Session Storage:
#    - Store user sessions
#    - Set appropriate TTL (e.g., 3600 = 1 hour)
#
# 2. Database Query Cache:
#    - Cache expensive queries
#    - Invalidate on data change
#
# 3. API Response Cache:
#    - Cache API responses
#    - Reduce backend load
#
# 4. Page Cache:
#    - Cache rendered pages
#    - Serve static content faster
#
# 5. Rate Limiting:
#    - Track request counts
#    - Use incr/decr commands

# ====================
# References
# ====================
# - Memcached: https://memcached.org/
# - Documentation: https://github.com/memcached/memcached/wiki
# - Docker Hub: https://hub.docker.com/_/memcached
# - Protocol: https://github.com/memcached/memcached/blob/master/doc/protocol.txt
# - Port guide: ../../docs/PORT_GUIDE.md
