# Squid Standalone Environment Configuration
# Copy this file to .env and customize the values

# ====================
# Project Settings
# ====================
PROJECT_NAME=squid
TZ=Asia/Seoul

# ====================
# Port Configuration
# ====================
SQUID_PORT=3128
SQUID_ICP_PORT=3129

# ====================
# Docker Image
# ====================
# Custom-built Squid image with optimized configuration
SQUID_IMAGE=scriptonbasestar/sb-docker-squid:latest

# ====================
# Container Names
# ====================
SQUID_CONTAINER_NAME=squid

# ====================
# Network Names
# ====================
PROXY_NETWORK=proxy-network

# ====================
# Volume Names
# ====================
SQUID_CACHE_VOLUME=squid-cache
SQUID_CONFIG_VOLUME=squid-config
SQUID_LOGS_VOLUME=squid-logs

# ====================
# Squid Configuration Notes
# ====================
# This image includes pre-configured settings:
# 1. localnet access is enabled by default
# 2. Configuration files can be added to /etc/squid/conf.d/
# 3. Cache directory: /var/spool/squid
# 4. Logs directory: /var/log/squid
#
# To add custom configuration:
# 1. Create .conf files in your local config directory
# 2. Mount them to /etc/squid/conf.d/ in compose.yml
# 3. Run: make reconfigure

# ====================
# Client Configuration
# ====================
# Linux/Mac:
#   export http_proxy=http://localhost:3128
#   export https_proxy=http://localhost:3128
#   export ftp_proxy=http://localhost:3128
#   export no_proxy="localhost,127.0.0.1"
#
# apt (Debian/Ubuntu):
#   echo 'Acquire::http::Proxy "http://localhost:3128";' | sudo tee /etc/apt/apt.conf.d/proxy.conf
#
# yum (CentOS/RHEL):
#   echo 'proxy=http://localhost:3128' | sudo tee -a /etc/yum.conf
#
# Docker daemon (/etc/docker/daemon.json):
#   {
#     "proxies": {
#       "http-proxy": "http://localhost:3128",
#       "https-proxy": "http://localhost:3128"
#     }
#   }

# ====================
# Cache Configuration Examples
# ====================
# Create a file in config volume: cache.conf
#
# Basic cache settings:
#   cache_mem 1024 MB
#   maximum_object_size 4096 MB
#   cache_dir ufs /var/spool/squid 5000 16 256
#
# ACL for specific domains:
#   acl debian_repos dstdomain .debian.org .ubuntu.com
#   cache allow debian_repos
#
# ACL for file types:
#   acl archive_files urlpath_regex \.(deb|rpm|zip|tar|gz|iso)$
#   cache allow archive_files

# ====================
# Access Control Examples
# ====================
# Create a file in config volume: acl.conf
#
# Allow specific networks:
#   acl allowed_ips src 192.168.1.0/24
#   http_access allow allowed_ips
#
# Block specific domains:
#   acl blocked_sites dstdomain .facebook.com .twitter.com
#   http_access deny blocked_sites
#
# Time-based access:
#   acl work_hours time MTWHF 09:00-18:00
#   http_access allow work_hours

# ====================
# Performance Tuning
# ====================
# For high-performance caching:
#
# 1. Increase cache memory:
#    cache_mem 2048 MB
#
# 2. Increase cache disk size:
#    cache_dir ufs /var/spool/squid 10000 16 256
#
# 3. Enable workers (CPU cores):
#    workers 4
#
# 4. DNS caching:
#    dns_nameservers 8.8.8.8 8.8.4.4
#    positive_dns_ttl 6 hours

# ====================
# Monitoring Commands
# ====================
# View statistics:
#   make stats
#
# View cache info:
#   make cache-info
#
# View logs:
#   make logs
#
# Test connection:
#   make test
#   curl -x http://localhost:3128 http://example.com

# ====================
# Security Notes
# ====================
# ⚠️  IMPORTANT Security Recommendations:
#
# 1. Network Access:
#    - By default, this image allows localnet access
#    - Restrict access using ACLs in custom config
#    - Never expose proxy to public internet without authentication
#
# 2. Authentication:
#    - Consider enabling proxy authentication for production
#    - Use Basic, Digest, or NTLM authentication
#    - Example: auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwords
#
# 3. SSL/TLS:
#    - Enable HTTPS inspection only when necessary
#    - Requires SSL certificate management
#    - Privacy concerns with SSL bumping
#
# 4. Access Logs:
#    - Monitor access logs regularly
#    - Check for unauthorized access attempts
#    - Implement log rotation
#
# 5. Resource Limits:
#    - Set appropriate cache size limits
#    - Monitor disk space usage
#    - Configure memory limits based on available RAM
#
# 6. Firewall:
#    - Use firewall to restrict proxy access
#    - Only allow trusted networks
#    - Block direct internet access from clients if using mandatory proxy

# ====================
# Common Use Cases
# ====================
# 1. Package Repository Caching:
#    - APT (Debian/Ubuntu) packages
#    - YUM (CentOS/RHEL) packages
#    - Docker registry images
#    - NPM/PyPI packages
#
# 2. Corporate Proxy:
#    - Web filtering and content control
#    - Bandwidth optimization
#    - Access logging and monitoring
#    - Internet usage policies
#
# 3. Development Environment:
#    - Speed up downloads
#    - Reduce bandwidth usage
#    - Test proxy configurations
#    - Debug HTTP traffic

# ====================
# Troubleshooting
# ====================
# Connection refused:
#   - Check if container is running: make ps
#   - Check logs: make logs
#   - Verify port binding: docker compose ps
#
# Access denied errors:
#   - Check ACL configuration
#   - Review /var/log/squid/access.log
#   - Verify client IP is in allowed networks
#
# Cache not working:
#   - Check cache configuration: make cache-info
#   - Verify disk space availability
#   - Review cache.log for errors
#
# Performance issues:
#   - Check memory usage: docker stats squid
#   - Review cache hit ratio: make stats
#   - Consider increasing cache_mem and cache_dir size

# ====================
# References
# ====================
# - Squid: http://www.squid-cache.org/
# - Documentation: http://www.squid-cache.org/Doc/
# - Configuration: https://wiki.squid-cache.org/SquidFaq/ConfiguringSquid
# - ACL Guide: https://wiki.squid-cache.org/SquidFaq/SquidAcl
# - Port guide: ../../docs/PORT_STATUS.md
